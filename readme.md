# Set up


### Installation steps
* Modify the magnolia.properties file:
	* Set the magnolia.resources.dir to the light-modules folder local path
	* Set the magnolia.repositories.home to the root path of the front-end-concept project
* Add the "rest-front-end" and "resources-front-end" roles to anonymous
* Add the "rest-front-end" and "resources-front-end" roles to superuser
* Disable the default public activation by setting /modules/publishing-core/config/receivers/magnoliaPublic8080@enabled to false
* Remove default config in the CORS filter:
	* Delete /server/filters/cors/bypasses/restApiPosts
	* Delete /server/filters/cors/bypasses/restApiSinglePost

### Angular
* Download the [Angular CLI library](https://cli.angular.io/)
* Execute **npm install** to install the necessary libraries (root: ../angular-app)
* Execute **ng build** to generate the distribution files anf make your change available in the pages app
* Execute **ng serve** to start the [Angular app](http://localhost:4200/)
* All the constants (DAM URL, REST URL, page node name, ...) are defined in the Angular environment file.
* IMPORTANT: **ng serve** delete the dist files generated by **ng build**. Therefore, execute that command after **ng serve**.


### React
* Execute **npm install** to install the necessary libraries (root: ../react-app)
* Execute **npm run build** to generate the distribution files anf make your change available in the pages app
* Execute **npm start** to start the [React app](http://localhost:3000/)

### Magnolia
* Import some trains records though the Trains app (files available in /WEB-INF/bootstrap/author)
* Import some loyalties records though the Loyalty app (files available in /WEB-INF/bootstrap/author)
* Add the following code at then end of the HEAD tag
* Put the **/server/filters/corsFilter** filter somewhere before the **/server/filters/servlets** filter

```
<script>
	window.singlePageConfig = {
		areaDefinitions: ${model.getAreaDefinitionsJson(content["mgnl:template"])!}, 
		componentsDefinitions: ${model.getComponentDefinitionsJson(content["mgnl:template"])!}, 
		content: ${model.getPageContent(content["@name"])!}
	}
</script>

[#assign url = ctx.request.scheme + "://" + ctx.request.serverName + ":" + ctx.request.serverPort?c + ctx.contextPath]
<script>
	window.editorEnvironment = {
		restUrl: "${url}/.rest/delivery/pages/v1/air-asia",
		trainRestUrl: "${url}/.rest/delivery/trains/v1/",
		loyaltyRestUrl: "${url}/.rest/delivery/loyalties/v1/",
		damUrl: "${url}/dam/",
		staticFilePath: "${url}/.resources/air-asia-demo/webresources"
	}
</script>
```
* Add the following line somewhere in the HEAD tag

```
[@cms.page /]
```


# API


### Area
* **cms-area** defines a Magnolia area. This attribute is listened by a directive which adds the **pages app** required HTML comments.
* **list-area** is the default implementation of the area (check Component section to see its code)
* **area-name** makes the link between the area name defined in Magnolia and the Angular area

Example:
```
<div areaName="left" cms-area list-area></div>
```


### Component
* **cms-component** defines a Magnolia component. This attribute is listened by a directive which adds the **pages app** required HTML comments.
* **[component]="component"** passes as parameter the Magnolia component content.

Example:
```
<ng-template ngFor let-component [ngForOf]="components">
    <ng-template [component]="component" cms-component></ng-template>
</ng-template>
```


### Mapping between the Magnolia components and the Angular ones
The mapping must be defined in the **src/environments/mapping.ts** angular file.

Example:
```
import { TitleComponent } 		from '../app/components/title/title.component';
import { TextImageComponent } 	from '../app/components/text-image/text-image.component';
import { SubtitleComponent } 	from '../app/components/subtitle/subtitle.component';
import { TimeTableComponent } 	from '../app/components/time-table/time-table.component';

export const COMPONENTS = {
	"magnolia-train-station:components/title": TitleComponent,
	"magnolia-train-station:components/text-image": TextImageComponent,
	"magnolia-train-station:components/subtitle": SubtitleComponent,
	"magnolia-train-station:components/time-table": TimeTableComponent
};
```